# サブストーリー設計

## サブストーリーの定義

### 基本原則

サブストーリーとは、メインプロットと並行して進行する独立した小さな物語のことである。

### 構造上の制約

| 制約 | 説明 |
|------|------|
| **アチーブメント連鎖で進行** | 通常のアチーブメントと同じ仕組みで実装する。各ステップが1つのアチーブメントに対応する |
| **メインプロットに影響しない** | サブストーリーのアチーブメントは、メインストーリーのどの `prerequisite` にも含まれない。サブストーリーを一切進めなくてもメインプロットは完走できる |
| **分岐しない** | サブストーリー内に選択肢や分岐は存在しない。一本道のチェーンである |
| **他サブストーリーに影響しない** | あるサブストーリーのアチーブメントが、別のサブストーリーの `prerequisite` になることはない。各サブストーリーは完全に独立している |
| **単調増加の条件集合** | 各ステップの発火条件は、前ステップの条件を必ず包含する。つまり条件値は常に前ステップ以上であり、途中で緩和されることがない |

### 単調増加の例

```
ステップ1: craft_count >= 5
ステップ2: craft_count >= 15
ステップ3: craft_count >= 30
```

条件が複合の場合も、すべての軸で前ステップ以上であること:

```
ステップ1: craft_count >= 10, day >= 30
ステップ2: craft_count >= 25, day >= 90
ステップ3: craft_count >= 50, day >= 180
```

### 順序保証

単調増加の条件集合であっても、`prerequisite` による順序制御は必要。同一フレームで複数ステップの条件を同時に満たした場合、全ステップが一気に発火するのを防ぐため。

### priority 帯域

メインストーリーイベント（601-1100）とは別の帯域を使用する。

| カテゴリ | priority 範囲 |
|---------|-------------|
| サブストーリー | 1101 - 2000 |

各サブストーリーに100の幅を割り当てる（例: サブストーリーA = 1101-1200, B = 1201-1300, ...）。

---

## サブストーリーのアイデア

### 1. おばあちゃんの薬草図鑑

**進行軸**: 採取回数（expedition_count）+ 調合回数（craft_count）+ レシピ数（recipe_count）
**キャラ**: リーネ
**概要**: リーネの祖母が残した手書きの薬草図鑑が見つかる。採取で素材を知り、調合で使い方を覚え、レシピが増えるにつれて図鑑の記述と自分の体験が重なっていく。図鑑には薬草の特性だけでなく、祖母の日常の思い出や村の昔の風景が記されている。最後のページには「この知恵を継ぐ者へ」というメッセージが。
**ステップ数**: 5段階
1. expedition 3 + craft 5（図鑑を見つける）
2. expedition 8 + craft 15 + recipe 3（祖母の採取ルートを辿る）
3. expedition 15 + craft 30 + recipe 5（図鑑のレシピを再現してみる）
4. expedition 25 + craft 50 + recipe 8（祖母の未完成のページ）
5. expedition 35 + craft 70 + recipe 10（「この知恵を継ぐ者へ」）

### 2. マルコの世間話

**進行軸**: 累計売上（total_sales）+ 日数（day）+ 依頼完了数（quest_count）
**キャラ**: マルコ
**概要**: マルコと取引を重ね、村での実績も積むにつれて打ち解けていく。最初は商売の話だけだが、やがて旅先の珍しい錬金術の話、変わった村の風習、旅商人ならではの処世術を語ってくれる。最終的にマルコがなぜ旅商人になったのか、その原点が語られる。
**ステップ数**: 5段階
1. total_sales 2000 + day 20（初めての世間話）
2. total_sales 8000 + day 60 + quest 5（旅先の錬金術師の話）
3. total_sales 20000 + day 120 + quest 12（商売の裏側）
4. total_sales 40000 + day 200 + quest 20（旅に出た理由）
5. total_sales 70000 + day 280 + quest 28（「あんたは俺の一番の取引相手だ」）

### 3. 工房の先住者

**進行軸**: 調合回数（craft_count）+ 日数（day）
**キャラ**: なし（システムメッセージ / 日記）
**概要**: 工房を使い込むうちに、前の住人が隠していた日記の断片が次々と見つかる。かつてこの工房にいた錬金術師の記録——フォンテの泉が枯れた時期、去ることになった事情、そして未完成のまま残されたレシピへの思い。主人公と境遇が重なる部分が多く、読み進めるうちに「自分はこの人の続きを歩いているんだ」と感じる構造。
**ステップ数**: 6段階
1. craft 5 + day 7（棚の裏から最初の1ページ）
2. craft 15 + day 30（大釜の下に挟まっていた束）
3. craft 30 + day 80（壁の隙間から）
4. craft 50 + day 150（床板の下の箱）
5. craft 75 + day 230（泉について書かれた章）
6. craft 100 + day 300（最後のページ「この工房を誰かに託す」）

### 4. レンとピィの冒険録

**進行軸**: 採取回数（expedition_count）+ レベル（level）+ 日数（day）
**キャラ**: レン、ピィ
**概要**: 採取を依頼し、主人公自身も腕を上げていくにつれて、レンとピィが次第に心を開く。最初はちょっとした武勇伝だが、次第にふたりがパーティーを組んだ経緯、以前の仲間との別れ、なぜこの辺境に留まっているのかが語られる。ピィの明るさの裏にある決意が印象的。
**ステップ数**: 5段階
1. expedition 5 + day 30（軽い武勇伝）
2. expedition 12 + lv 5 + day 80（パーティー結成の話）
3. expedition 20 + lv 8 + day 140（以前の仲間との別れ）
4. expedition 30 + lv 12 + day 220（この村に留まる理由）
5. expedition 40 + lv 15 + day 300（「お前のおかげでここに居場所ができた」）

### 5. ゴルドの無口な背中

**進行軸**: 調合回数（craft_count）+ レベル（level）
**キャラ**: ゴルド
**概要**: ゴルドは基本無口だが、主人公が腕を上げるにつれて少しずつ口を開く。鍛冶屋としての矜持、かつて王都で働いていた過去、なぜこの村に来たのか。最後に「お前の道具を打たせてくれ」と自ら申し出る。
**ステップ数**: 4段階
1. craft 20 + lv 5（「……悪くない腕だ」）
2. craft 40 + lv 8（王都の鍛冶工房の話）
3. craft 60 + lv 12（村に来た理由）
4. craft 80 + lv 15（「お前の道具を打たせてくれ」）

### 6. 星読みの夜

**進行軸**: 日数（day）
**キャラ**: リーネ、村長
**概要**: 季節の変わり目に、主人公が夜空を見上げるシーン。春の星座、夏の流れ星、秋の月、冬の星空。それぞれの夜にリーネや村長がふらっと現れて、星にまつわる村の言い伝えを教えてくれる。ゲーム世界の季節感と風景描写に特化した、穏やかなサブストーリー。
**ステップ数**: 4段階
1. day 45（春の星座 — 村長が語る）
2. day 135（夏の流れ星 — リーネと一緒に）
3. day 225（秋の月 — 村長が収穫祭の思い出を）
4. day 315（冬の星空 — リーネ「来年もここで見られるといいね」）

### 7. メルダ食堂の常連

**進行軸**: 依頼完了数（quest_count）+ 名声（reputation）+ 日数（day）
**キャラ**: メルダ
**概要**: 依頼をこなし名声を上げていくと、メルダのパン屋で聞ける話が変わっていく。最初は軽い噂話だが、主人公が村に認められるにつれて、村人の本音や歴史、メルダ自身の過去も語られる。村の生活が立体的に見えてくる「村の日常」を描くサブストーリー。
**ステップ数**: 5段階
1. quest 3 + day 15（「常連さんね」— 軽い噂話）
2. quest 8 + reputation 15 + day 50（村人たちの人間関係）
3. quest 15 + reputation 30 + day 120（メルダの若い頃の話）
4. quest 25 + reputation 50 + day 220（村が衰退していった頃の話）
5. quest 35 + reputation 65 + day 300（「あんたが来てから、この村明るくなったよ」）

### 8. 師匠の若い頃

**進行軸**: レベル（level）
**キャラ**: イリーナ（手紙）
**概要**: レベルが上がるごとに、師匠イリーナから個人的な手紙が届く。内容は錬金術の助言ではなく、イリーナ自身の若い頃の失敗談、初めて調合に成功した日の話、師匠の師匠の教え。主人公が成長するにつれて、手紙の語りかけの口調が「弟子へ」から「同業者へ」に変わっていく。
**ステップ数**: 5段階
1. lv 3（初めての失敗談）
2. lv 6（師匠の師匠の話）
3. lv 10（初めて調合に成功した日）
4. lv 14（なぜ教える側に回ったか）
5. lv 18（「もう弟子ではなく、同業者として」）

### 9. 野良猫のフォンテ

**進行軸**: 日数（day）+ 調合回数（craft_count）
**キャラ**: なし（ナレーション）
**概要**: ある日から工房に野良猫が居つくようになる。最初は警戒して逃げるが、日が経ち工房で過ごす時間が増えるにつれて距離が縮まる。猫の仕草を通じて季節の移ろいと主人公の生活の変化を映し出す、セリフ少なめの情景描写サブストーリー。猫の名前は村の子供が「フォンテ」と名付ける。
**ステップ数**: 5段階
1. day 14 + craft 3（工房の入口に猫がいる）
2. day 60 + craft 15（窓辺に座るようになる）
3. day 120 + craft 30（調合中に足元にいる）
4. day 200 + craft 50（膝の上に乗ってくる）
5. day 300 + craft 70（工房の定位置で丸くなっている。村の子供が「フォンテ」と名付ける）

### 10. 枯泉のささやき

**進行軸**: 採取回数（expedition_count）+ 村発展度（village_development）+ 調合品質（craft_quality）
**キャラ**: なし（ナレーション / 不思議な声）
**概要**: 枯泉の丘で採取を続け、村が発展し、主人公の腕が上がるにつれて、泉の跡地で不思議な気配を感じるようになる。風の音に混じる声、土の中から微かに光る鉱石、枯れたはずの泉底に滲む水滴。フォンテの泉が完全に死んだわけではなく、村が活気を取り戻すにつれて泉もかすかに応えている——という、村の再生を象徴するサブストーリー。
**ステップ数**: 4段階
1. expedition 10 + vd 15（風の音に何かが混じる）
2. expedition 20 + vd 30 + quality 50（土中に微かな光）
3. expedition 30 + vd 45 + quality 70（泉底に水滴が滲む）
4. expedition 40 + vd 60 + quality 85（泉がかすかに脈打っている）
